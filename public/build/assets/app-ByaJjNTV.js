var F=function(e,t,n,i){if(n==="a"&&!i)throw new TypeError("Private accessor was defined without a getter");if(typeof t=="function"?e!==t||!i:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return n==="m"?i:n==="a"?i.call(e):i?i.value:t.get(e)},M,O;const ht=["[data-md-button]","md-header","md-bold","md-italic","md-quote","md-code","md-link","md-image","md-unordered-list","md-ordered-list","md-task-list","md-mention","md-ref","md-strikethrough"];function lt(e){const t=[];for(const n of e.querySelectorAll(ht.join(", ")))n.hidden||n.offsetWidth<=0&&n.offsetHeight<=0||n.closest("markdown-toolbar")===e&&t.push(n);return t}function ct(e){return function(t){(t.key===" "||t.key==="Enter")&&e(t)}}const p=new WeakMap,ft={"header-1":{prefix:"# "},"header-2":{prefix:"## "},"header-3":{prefix:"### "},"header-4":{prefix:"#### "},"header-5":{prefix:"##### "},"header-6":{prefix:"###### "},bold:{prefix:"**",suffix:"**",trimFirst:!0},italic:{prefix:"_",suffix:"_",trimFirst:!0},quote:{prefix:"> ",multiline:!0,surroundWithNewlines:!0},code:{prefix:"`",suffix:"`",blockPrefix:"```",blockSuffix:"```"},link:{prefix:"[",suffix:"](url)",replaceNext:"url",scanFor:"https?://"},image:{prefix:"![",suffix:"](url)",replaceNext:"url",scanFor:"https?://"},"unordered-list":{prefix:"- ",multiline:!0,unorderedList:!0},"ordered-list":{prefix:"1. ",multiline:!0,orderedList:!0},"task-list":{prefix:"- [ ] ",multiline:!0,surroundWithNewlines:!0},mention:{prefix:"@",prefixSpace:!0},ref:{prefix:"#",prefixSpace:!0},strikethrough:{prefix:"~~",suffix:"~~",trimFirst:!0}};class w extends HTMLElement{constructor(){super();const t=n=>{const i=p.get(this);i&&(n.preventDefault(),I(this,i))};this.addEventListener("keydown",ct(t)),this.addEventListener("click",t)}connectedCallback(){this.hasAttribute("role")||this.setAttribute("role","button")}click(){const t=p.get(this);t&&I(this,t)}}class N extends w{constructor(){super(...arguments),M.add(this)}connectedCallback(){const t=parseInt(this.getAttribute("level")||"3",10);F(this,M,"m",O).call(this,t)}static get observedAttributes(){return["level"]}attributeChangedCallback(t,n,i){if(t!=="level")return;const s=parseInt(i||"3",10);F(this,M,"m",O).call(this,s)}}M=new WeakSet,O=function(t){if(t<1||t>6)return;const n=`${"#".repeat(t)} `;p.set(this,{prefix:n})};window.customElements.get("md-header")||(window.MarkdownHeaderButtonElement=N,window.customElements.define("md-header",N));class _ extends w{connectedCallback(){p.set(this,{prefix:"**",suffix:"**",trimFirst:!0})}}window.customElements.get("md-bold")||(window.MarkdownBoldButtonElement=_,window.customElements.define("md-bold",_));class q extends w{connectedCallback(){p.set(this,{prefix:"_",suffix:"_",trimFirst:!0})}}window.customElements.get("md-italic")||(window.MarkdownItalicButtonElement=q,window.customElements.define("md-italic",q));class j extends w{connectedCallback(){p.set(this,{prefix:"> ",multiline:!0,surroundWithNewlines:!0})}}window.customElements.get("md-quote")||(window.MarkdownQuoteButtonElement=j,window.customElements.define("md-quote",j));class U extends w{connectedCallback(){p.set(this,{prefix:"`",suffix:"`",blockPrefix:"```",blockSuffix:"```"})}}window.customElements.get("md-code")||(window.MarkdownCodeButtonElement=U,window.customElements.define("md-code",U));class D extends w{connectedCallback(){p.set(this,{prefix:"[",suffix:"](url)",replaceNext:"url",scanFor:"https?://"})}}window.customElements.get("md-link")||(window.MarkdownLinkButtonElement=D,window.customElements.define("md-link",D));class K extends w{connectedCallback(){p.set(this,{prefix:"![",suffix:"](url)",replaceNext:"url",scanFor:"https?://"})}}window.customElements.get("md-image")||(window.MarkdownImageButtonElement=K,window.customElements.define("md-image",K));class z extends w{connectedCallback(){p.set(this,{prefix:"- ",multiline:!0,unorderedList:!0})}}window.customElements.get("md-unordered-list")||(window.MarkdownUnorderedListButtonElement=z,window.customElements.define("md-unordered-list",z));class V extends w{connectedCallback(){p.set(this,{prefix:"1. ",multiline:!0,orderedList:!0})}}window.customElements.get("md-ordered-list")||(window.MarkdownOrderedListButtonElement=V,window.customElements.define("md-ordered-list",V));class G extends w{connectedCallback(){p.set(this,{prefix:"- [ ] ",multiline:!0,surroundWithNewlines:!0})}}window.customElements.get("md-task-list")||(window.MarkdownTaskListButtonElement=G,window.customElements.define("md-task-list",G));class Q extends w{connectedCallback(){p.set(this,{prefix:"@",prefixSpace:!0})}}window.customElements.get("md-mention")||(window.MarkdownMentionButtonElement=Q,window.customElements.define("md-mention",Q));class J extends w{connectedCallback(){p.set(this,{prefix:"#",prefixSpace:!0})}}window.customElements.get("md-ref")||(window.MarkdownRefButtonElement=J,window.customElements.define("md-ref",J));class X extends w{connectedCallback(){p.set(this,{prefix:"~~",suffix:"~~",trimFirst:!0})}}window.customElements.get("md-strikethrough")||(window.MarkdownStrikethroughButtonElement=X,window.customElements.define("md-strikethrough",X));function Y(e){const{target:t,currentTarget:n}=e;if(!(t instanceof Element))return;const i=t.closest("[data-md-button]");if(!i||i.closest("markdown-toolbar")!==n)return;const s=i.getAttribute("data-md-button"),o=ft[s];o&&(e.preventDefault(),I(t,o))}function Z(e){e.addEventListener("keydown",at),e.setAttribute("tabindex","0"),e.addEventListener("focus",dt,{once:!0})}function tt(e){e.removeEventListener("keydown",at),e.removeAttribute("tabindex"),e.removeEventListener("focus",dt)}class A extends HTMLElement{connectedCallback(){this.hasAttribute("role")||this.setAttribute("role","toolbar"),this.hasAttribute("data-no-focus")||Z(this),this.addEventListener("keydown",ct(Y)),this.addEventListener("click",Y)}attributeChangedCallback(t,n,i){t==="data-no-focus"&&(i===null?Z(this):tt(this))}disconnectedCallback(){tt(this)}get field(){const t=this.getAttribute("for");if(!t)return null;const n="getRootNode"in this?this.getRootNode():document;let i;return(n instanceof Document||n instanceof ShadowRoot)&&(i=n.getElementById(t)),i instanceof HTMLTextAreaElement?i:null}}A.observedAttributes=["data-no-focus"];function dt({target:e}){if(!(e instanceof Element))return;e.removeAttribute("tabindex");let t="0";for(const n of lt(e))n.setAttribute("tabindex",t),t==="0"&&(n.focus(),t="-1")}function at(e){const t=e.key;if(t!=="ArrowRight"&&t!=="ArrowLeft"&&t!=="Home"&&t!=="End")return;const n=e.currentTarget;if(!(n instanceof HTMLElement))return;const i=lt(n),s=i.indexOf(e.target),o=i.length;if(s===-1)return;let r=0;t==="ArrowLeft"&&(r=s-1),t==="ArrowRight"&&(r=s+1),t==="End"&&(r=o-1),r<0&&(r=o-1),r>o-1&&(r=0);for(let l=0;l<o;l+=1)i[l].setAttribute("tabindex",l===r?"0":"-1");e.preventDefault(),i[r].focus()}window.customElements.get("markdown-toolbar")||(window.MarkdownToolbarElement=A,window.customElements.define("markdown-toolbar",A));function W(e){return e.trim().split(`
`).length>1}function et(e,t){return Array(t+1).join(e)}function mt(e,t){let n=t;for(;e[n]&&e[n-1]!=null&&!e[n-1].match(/\s/);)n--;return n}function pt(e,t,n){let i=t;const s=n?/\n/:/\s/;for(;e[i]&&!e[i].match(s);)i++;return i}let x=null;function wt(e,{text:t,selectionStart:n,selectionEnd:i}){const s=e.selectionStart,o=e.value.slice(0,s),r=e.value.slice(e.selectionEnd);if(x===null||x===!0){e.contentEditable="true";try{x=document.execCommand("insertText",!1,t)}catch{x=!1}e.contentEditable="false"}if(x&&!e.value.slice(0,e.selectionStart).endsWith(t)&&(x=!1),!x){try{document.execCommand("ms-beginUndoUnit")}catch{}e.value=o+t+r;try{document.execCommand("ms-endUndoUnit")}catch{}e.dispatchEvent(new CustomEvent("input",{bubbles:!0,cancelable:!0}))}n!=null&&i!=null?e.setSelectionRange(n,i):e.setSelectionRange(s,e.selectionEnd)}function gt(e,t){const n=e.value.slice(e.selectionStart,e.selectionEnd);let i;t.orderedList||t.unorderedList?i=St(e,t):t.multiline&&W(n)?i=kt(e,t):i=vt(e,t),wt(e,i)}function Et(e){const t=e.value.split(`
`);let n=0;for(let i=0;i<t.length;i++){const s=t[i].length+1;e.selectionStart>=n&&e.selectionStart<n+s&&(e.selectionStart=n),e.selectionEnd>=n&&e.selectionEnd<n+s&&(e.selectionEnd=n+s-1),n+=s}}function bt(e,t,n,i=!1){if(e.selectionStart===e.selectionEnd)e.selectionStart=mt(e.value,e.selectionStart),e.selectionEnd=pt(e.value,e.selectionEnd,i);else{const s=e.selectionStart-t.length,o=e.selectionEnd+n.length,r=e.value.slice(s,e.selectionStart)===t,l=e.value.slice(e.selectionEnd,o)===n;r&&l&&(e.selectionStart=s,e.selectionEnd=o)}return e.value.slice(e.selectionStart,e.selectionEnd)}function R(e){const t=e.value.slice(0,e.selectionStart),n=e.value.slice(e.selectionEnd),i=t.match(/\n*$/),s=n.match(/^\n*/),o=i?i[0].length:0,r=s?s[0].length:0;let l,c;return t.match(/\S/)&&o<2&&(l=et(`
`,2-o)),n.match(/\S/)&&r<2&&(c=et(`
`,2-r)),l==null&&(l=""),c==null&&(c=""),{newlinesToAppend:l,newlinesToPrepend:c}}function vt(e,t){let n,i;const{prefix:s,suffix:o,blockPrefix:r,blockSuffix:l,replaceNext:c,prefixSpace:g,scanFor:d,surroundWithNewlines:E}=t,b=e.selectionStart,y=e.selectionEnd;let h=e.value.slice(e.selectionStart,e.selectionEnd),a=W(h)&&r.length>0?`${r}
`:s,f=W(h)&&l.length>0?`
${l}`:o;if(g){const m=e.value[e.selectionStart-1];e.selectionStart!==0&&m!=null&&!m.match(/\s/)&&(a=` ${a}`)}h=bt(e,a,f,t.multiline);let u=e.selectionStart,v=e.selectionEnd;const ut=c.length>0&&f.indexOf(c)>-1&&h.length>0;if(E){const m=R(e);n=m.newlinesToAppend,i=m.newlinesToPrepend,a=n+s,f+=i}if(h.startsWith(a)&&h.endsWith(f)){const m=h.slice(a.length,h.length-f.length);if(b===y){let k=b-a.length;k=Math.max(k,u),k=Math.min(k,u+m.length),u=v=k}else v=u+m.length;return{text:m,selectionStart:u,selectionEnd:v}}else if(ut)if(d.length>0&&h.match(d)){f=f.replace(c,h);const m=a+f;return u=v=u+a.length,{text:m,selectionStart:u,selectionEnd:v}}else{const m=a+h+f;return u=u+a.length+h.length+f.indexOf(c),v=u+c.length,{text:m,selectionStart:u,selectionEnd:v}}else{let m=a+h+f;u=b+a.length,v=y+a.length;const k=h.match(/^\s*|\s*$/g);if(t.trimFirst&&k){const P=k[0]||"",$=k[1]||"";m=P+a+h.trim()+f+$,u+=P.length,v-=$.length}return{text:m,selectionStart:u,selectionEnd:v}}}function kt(e,t){const{prefix:n,suffix:i,surroundWithNewlines:s}=t;let o=e.value.slice(e.selectionStart,e.selectionEnd),r=e.selectionStart,l=e.selectionEnd;const c=o.split(`
`);if(c.every(d=>d.startsWith(n)&&d.endsWith(i)))o=c.map(d=>d.slice(n.length,d.length-i.length)).join(`
`),l=r+o.length;else if(o=c.map(d=>n+d+i).join(`
`),s){const{newlinesToAppend:d,newlinesToPrepend:E}=R(e);r+=d.length,l=r+o.length,o=d+o+E}return{text:o,selectionStart:r,selectionEnd:l}}function nt(e){const t=e.split(`
`),n=/^\d+\.\s+/,i=t.every(o=>n.test(o));let s=t;return i&&(s=t.map(o=>o.replace(n,""))),{text:s.join(`
`),processed:i}}function it(e){const t=e.split(`
`),n="- ",i=t.every(o=>o.startsWith(n));let s=t;return i&&(s=t.map(o=>o.slice(n.length,o.length))),{text:s.join(`
`),processed:i}}function S(e,t){return t?"- ":`${e+1}. `}function xt(e,t){let n,i,s;return e.orderedList?(i=nt(t),n=it(i.text),s=n.text):(i=it(t),n=nt(i.text),s=n.text),[i,n,s]}function St(e,t){const n=e.selectionStart===e.selectionEnd;let i=e.selectionStart,s=e.selectionEnd;Et(e);const o=e.value.slice(e.selectionStart,e.selectionEnd),[r,l,c]=xt(t,o),g=c.split(`
`).map((a,f)=>`${S(f,t.unorderedList)}${a}`),d=g.reduce((a,f,u)=>a+S(u,t.unorderedList).length,0),E=g.reduce((a,f,u)=>a+S(u,!t.unorderedList).length,0);if(r.processed)return n?(i=Math.max(i-S(0,t.unorderedList).length,0),s=i):(i=e.selectionStart,s=e.selectionEnd-d),{text:c,selectionStart:i,selectionEnd:s};const{newlinesToAppend:b,newlinesToPrepend:y}=R(e),h=b+g.join(`
`)+y;return n?(i=Math.max(i+S(0,t.unorderedList).length+b.length,0),s=i):l.processed?(i=Math.max(e.selectionStart+b.length,0),s=e.selectionEnd+b.length+d-E):(i=Math.max(e.selectionStart+b.length,0),s=e.selectionEnd+b.length+d),{text:h,selectionStart:i,selectionEnd:s}}function I(e,t){const n=e.closest("markdown-toolbar");if(!(n instanceof A))return;const s=Object.assign(Object.assign({},{prefix:"",suffix:"",blockPrefix:"",blockSuffix:"",multiline:!1,replaceNext:"",prefixSpace:!1,scanFor:"",surroundWithNewlines:!1,orderedList:!1,unorderedList:!1,trimFirst:!1}),t),o=n.field;o&&(o.focus(),gt(o,s))}class yt{constructor(t,n,{tabInsertsSuggestions:i,defaultFirstOption:s,scrollIntoViewOptions:o}={}){this.input=t,this.list=n,this.tabInsertsSuggestions=i??!0,this.defaultFirstOption=s??!1,this.scrollIntoViewOptions=o??{block:"nearest",inline:"nearest"},this.isComposing=!1,n.id||(n.id=`combobox-${Math.random().toString().slice(2,6)}`),this.ctrlBindings=!!navigator.userAgent.match(/Macintosh/),this.keyboardEventHandler=r=>Lt(r,this),this.compositionEventHandler=r=>Bt(r,this),this.inputHandler=this.clearSelection.bind(this),t.setAttribute("role","combobox"),t.setAttribute("aria-controls",n.id),t.setAttribute("aria-expanded","false"),t.setAttribute("aria-autocomplete","list"),t.setAttribute("aria-haspopup","listbox")}destroy(){this.clearSelection(),this.stop(),this.input.removeAttribute("role"),this.input.removeAttribute("aria-controls"),this.input.removeAttribute("aria-expanded"),this.input.removeAttribute("aria-autocomplete"),this.input.removeAttribute("aria-haspopup")}start(){this.input.setAttribute("aria-expanded","true"),this.input.addEventListener("compositionstart",this.compositionEventHandler),this.input.addEventListener("compositionend",this.compositionEventHandler),this.input.addEventListener("input",this.inputHandler),this.input.addEventListener("keydown",this.keyboardEventHandler),this.list.addEventListener("click",st),this.indicateDefaultOption()}stop(){this.clearSelection(),this.input.setAttribute("aria-expanded","false"),this.input.removeEventListener("compositionstart",this.compositionEventHandler),this.input.removeEventListener("compositionend",this.compositionEventHandler),this.input.removeEventListener("input",this.inputHandler),this.input.removeEventListener("keydown",this.keyboardEventHandler),this.list.removeEventListener("click",st)}indicateDefaultOption(){var t;this.defaultFirstOption&&((t=Array.from(this.list.querySelectorAll('[role="option"]:not([aria-disabled="true"])')).filter(C)[0])===null||t===void 0||t.setAttribute("data-combobox-option-default","true"))}navigate(t=1){const n=Array.from(this.list.querySelectorAll('[aria-selected="true"]')).filter(C)[0],i=Array.from(this.list.querySelectorAll('[role="option"]')).filter(C),s=i.indexOf(n);if(s===i.length-1&&t===1||s===0&&t===-1){this.clearSelection(),this.input.focus();return}let o=t===1?0:i.length-1;if(n&&s>=0){const l=s+t;l>=0&&l<i.length&&(o=l)}const r=i[o];if(r)for(const l of i)l.removeAttribute("data-combobox-option-default"),r===l?(this.input.setAttribute("aria-activedescendant",r.id),r.setAttribute("aria-selected","true"),At(r),r.scrollIntoView(this.scrollIntoViewOptions)):l.removeAttribute("aria-selected")}clearSelection(){this.input.removeAttribute("aria-activedescendant");for(const t of this.list.querySelectorAll('[aria-selected="true"]'))t.removeAttribute("aria-selected");this.indicateDefaultOption()}}function Lt(e,t){if(!(e.shiftKey||e.metaKey||e.altKey)&&!(!t.ctrlBindings&&e.ctrlKey)&&!t.isComposing)switch(e.key){case"Enter":ot(t.input,t.list)&&e.preventDefault();break;case"Tab":t.tabInsertsSuggestions&&ot(t.input,t.list)&&e.preventDefault();break;case"Escape":t.clearSelection();break;case"ArrowDown":t.navigate(1),e.preventDefault();break;case"ArrowUp":t.navigate(-1),e.preventDefault();break;case"n":t.ctrlBindings&&e.ctrlKey&&(t.navigate(1),e.preventDefault());break;case"p":t.ctrlBindings&&e.ctrlKey&&(t.navigate(-1),e.preventDefault());break;default:if(e.ctrlKey)break;t.clearSelection()}}function st(e){if(!(e.target instanceof Element))return;const t=e.target.closest('[role="option"]');t&&t.getAttribute("aria-disabled")!=="true"&&Mt(t,{event:e})}function ot(e,t){const n=t.querySelector('[aria-selected="true"], [data-combobox-option-default="true"]');return n?(n.getAttribute("aria-disabled")==="true"||n.click(),!0):!1}function Mt(e,t){e.dispatchEvent(new CustomEvent("combobox-commit",{bubbles:!0,detail:t}))}function At(e){e.dispatchEvent(new Event("combobox-select",{bubbles:!0}))}function C(e){return!e.hidden&&!(e instanceof HTMLInputElement&&e.type==="hidden")&&(e.offsetWidth>0||e.offsetHeight>0)}function Bt(e,t){t.isComposing=e.type==="compositionstart",document.getElementById(t.input.getAttribute("aria-controls")||"")&&t.clearSelection()}const Ct=/\s|\(|\[/;function Tt(e,t,n,{multiWord:i,lookBackIndex:s,lastMatchPosition:o}={multiWord:!1,lookBackIndex:0,lastMatchPosition:null}){let r=e.lastIndexOf(t,n-1);if(r===-1||r<s)return;if(i){if(o!=null){if(o===r)return;r=o-t.length}if(e[r+1]===" "&&n>=r+t.length+1||e.lastIndexOf(`
`,n-1)>r||e.lastIndexOf(".",n-1)>r)return}else if(e.lastIndexOf(" ",n-1)>r)return;const l=e[r-1];return l&&!Ct.test(l)?void 0:{text:e.substring(r+t.length,n),position:r+t.length}}class Ot extends Event{constructor(){super("update")}}const T=new WeakMap;class H extends EventTarget{#e=new MutationObserver(()=>this.#h());#s=new ResizeObserver(()=>this.#u());#o;#n=document.createElement("div");#t=document.createElement("div");static for(t){let n=T.get(t);return n||(n=new H(t),T.set(t,n)),n}constructor(t){super(),this.#o=new WeakRef(t),this.#n.style.position="absolute",this.#n.style.pointerEvents="none",this.#n.setAttribute("aria-hidden","true"),this.#n.appendChild(this.#t),this.#t.style.pointerEvents="none",this.#t.style.userSelect="none",this.#t.style.overflow="hidden",this.#t.style.display="block",this.#t.style.visibility="hidden",t instanceof HTMLTextAreaElement?(this.#t.style.whiteSpace="pre-wrap",this.#t.style.wordWrap="break-word"):(this.#t.style.whiteSpace="nowrap",this.#t.style.display="table-cell",this.#t.style.verticalAlign="middle"),t.after(this.#n),this.#h(),this.#f(),this.#e.observe(t,{attributeFilter:["style","dir"]}),this.#s.observe(t),document.addEventListener("scroll",this.#l,{capture:!0}),window.addEventListener("resize",this.#l,{capture:!0}),t.addEventListener("input",this.#p,{capture:!0})}get element(){return this.#t}forceUpdate(){this.#h(),this.#f()}disconnect(){this.#n?.remove(),this.#e.disconnect(),this.#s.disconnect(),document.removeEventListener("scroll",this.#l,{capture:!0}),window.removeEventListener("resize",this.#l,{capture:!0});const t=this.#r;t&&(t.removeEventListener("input",this.#p,{capture:!0}),T.delete(t))}get#r(){return this.#o?.deref()}#i(t){const n=this.#r;return n?t(n):this.disconnect()}#c=0;#d=0;#m(){this.#i(t=>{const n=window.getComputedStyle(t);this.#t.style.height=n.height,this.#t.style.width=n.width,t.clientHeight!==this.#t.clientHeight&&(this.#t.style.height=`calc(${n.height} + ${t.clientHeight-this.#t.clientHeight}px)`),t.clientWidth!==this.#t.clientWidth&&(this.#t.style.width=`calc(${n.width} + ${t.clientWidth-this.#t.clientWidth}px)`);const i=t.getBoundingClientRect(),s=this.#t.getBoundingClientRect();this.#c=this.#c+i.left-s.left,this.#d=this.#d+i.top-s.top,this.#t.style.transform=`translate(${this.#c}px, ${this.#d}px)`,this.#t.scrollTop=t.scrollTop,this.#t.scrollLeft=t.scrollLeft,this.dispatchEvent(new Ot)})}#a=!1;#u(){this.#a||(this.#a=!0,requestAnimationFrame(()=>{this.#m(),this.#a=!1}))}#h(){this.#i(t=>{const n=window.getComputedStyle(t);for(const i of Wt)this.#t.style[i]=n[i];this.#u()})}#f(){this.#i(t=>{this.#t.textContent=t.value,this.#m()})}#p=()=>this.#f();#l=t=>{this.#i(n=>{(t.target===document||t.target===window||t.target instanceof Node&&t.target.contains(n))&&this.#u()})}}const Wt=["direction","writingMode","unicodeBidi","textOrientation","boxSizing","borderTopWidth","borderRightWidth","borderBottomWidth","borderLeftWidth","borderStyle","paddingTop","paddingRight","paddingBottom","paddingLeft","fontStyle","fontVariant","fontWeight","fontStretch","fontSize","fontSizeAdjust","lineHeight","fontFamily","textAlign","textTransform","textIndent","textDecoration","letterSpacing","wordSpacing","tabSize","MozTabSize"];class B{#e;#s;#o;constructor(t,n=0,i=n){this.#e=t,this.#s=n,this.#o=i}static fromSelection(t){const{selectionStart:n,selectionEnd:i}=t;return new B(t,n??void 0,i??void 0)}get collapsed(){return this.startOffset===this.endOffset}get commonAncestorContainer(){return this.#e}get endContainer(){return this.#e}get startContainer(){return this.#e}get startOffset(){return this.#s}get endOffset(){return this.#o}setStartOffset(t){this.#s=this.#r(t)}setEndOffset(t){this.#o=this.#r(t)}collapse(t=!1){t?this.setEndOffset(this.startOffset):this.setStartOffset(this.endOffset)}cloneContents(){return this.#i().cloneContents()}cloneRange(){return new B(this.#e,this.startOffset,this.endOffset)}getBoundingClientRect(){return this.#i().getBoundingClientRect()}getClientRects(){return this.#i().getClientRects()}toString(){return this.#i().toString()}getStyleClone(){return this.#n}get#n(){return H.for(this.#e)}get#t(){return this.#n}#r(t){return Math.max(0,Math.min(t,this.#e.value.length))}#i(){const t=document.createRange(),n=this.#t.element.childNodes[0];return n&&(t.setStart(n,this.startOffset),t.setEnd(n,this.endOffset)),t}}const L=new WeakMap;class It{constructor(t,n){this.expander=t,this.input=n,this.combobox=null,this.menu=null,this.match=null,this.justPasted=!1,this.lookBackIndex=0,this.oninput=this.onInput.bind(this),this.onpaste=this.onPaste.bind(this),this.onkeydown=this.onKeydown.bind(this),this.oncommit=this.onCommit.bind(this),this.onmousedown=this.onMousedown.bind(this),this.onblur=this.onBlur.bind(this),this.interactingWithList=!1,n.addEventListener("paste",this.onpaste),n.addEventListener("input",this.oninput),n.addEventListener("keydown",this.onkeydown),n.addEventListener("blur",this.onblur)}destroy(){this.input.removeEventListener("paste",this.onpaste),this.input.removeEventListener("input",this.oninput),this.input.removeEventListener("keydown",this.onkeydown),this.input.removeEventListener("blur",this.onblur)}dismissMenu(){this.deactivate()&&(this.lookBackIndex=this.input.selectionEnd||this.lookBackIndex)}activate(t,n){var i,s;this.input!==document.activeElement&&this.input!==((s=(i=document.activeElement)===null||i===void 0?void 0:i.shadowRoot)===null||s===void 0?void 0:s.activeElement)||(this.deactivate(),this.menu=n,n.id||(n.id=`text-expander-${Math.floor(Math.random()*1e5).toString()}`),this.expander.append(n),this.combobox=new yt(this.input,n),this.expander.dispatchEvent(new Event("text-expander-activate")),this.positionMenu(n,t.position),this.combobox.start(),n.addEventListener("combobox-commit",this.oncommit),n.addEventListener("mousedown",this.onmousedown),this.combobox.navigate(1))}positionMenu(t,n){const i=Math.min(n,this.input.value.length),s=new B(this.input,i).getBoundingClientRect(),o={left:s.left,top:s.top+s.height},r=t.getBoundingClientRect(),l={left:o.left-r.left,top:o.top-r.top};if(l.left!==0||l.top!==0){const c=getComputedStyle(t);t.style.left=c.left?`calc(${c.left} + ${l.left}px)`:`${l.left}px`,t.style.top=c.top?`calc(${c.top} + ${l.top}px)`:`${l.top}px`}}deactivate(){const t=this.menu;return!t||!this.combobox?!1:(this.expander.dispatchEvent(new Event("text-expander-deactivate")),this.menu=null,t.removeEventListener("combobox-commit",this.oncommit),t.removeEventListener("mousedown",this.onmousedown),this.combobox.destroy(),this.combobox=null,t.remove(),!0)}onCommit({target:t}){var n;const i=t;if(!(i instanceof HTMLElement)||!this.combobox)return;const s=this.match;if(!s)return;const o=this.input.value.substring(0,s.position-s.key.length),r=this.input.value.substring(s.position+s.text.length),l={item:i,key:s.key,value:null,continue:!1};if(!this.expander.dispatchEvent(new CustomEvent("text-expander-value",{cancelable:!0,detail:l}))||!l.value)return;let g=(n=this.expander.getAttribute("suffix"))!==null&&n!==void 0?n:" ";l.continue&&(g="");const d=`${l.value}${g}`;this.input.value=o+d+r;const E=o.length+d.length;this.deactivate(),this.input.focus({preventScroll:!0}),this.input.selectionStart=E,this.input.selectionEnd=E,l.continue||(this.lookBackIndex=E,this.match=null),this.expander.dispatchEvent(new CustomEvent("text-expander-committed",{cancelable:!1,detail:{input:this.input}}))}onBlur(){if(this.interactingWithList){this.interactingWithList=!1;return}this.deactivate()}onPaste(){this.justPasted=!0}isMatchStillValid(t){return t.position<=this.input.value.length}async onInput(){if(this.justPasted){this.justPasted=!1;return}const t=this.findMatch();if(t){this.match=t;const n=await this.notifyProviders(t);if(!this.match||!this.isMatchStillValid(t)){this.match=null,this.deactivate();return}n?this.activate(t,n):this.deactivate()}else this.match=null,this.deactivate()}findMatch(){const t=this.input.selectionEnd||0,n=this.input.value;t<=this.lookBackIndex&&(this.lookBackIndex=t-1);for(const{key:i,multiWord:s}of this.expander.keys){const o=Tt(n,i,t,{multiWord:s,lookBackIndex:this.lookBackIndex,lastMatchPosition:this.match?this.match.position:null});if(o)return{text:o.text,key:i,position:o.position}}}async notifyProviders(t){const n=[],i=c=>n.push(c),s=new CustomEvent("text-expander-change",{cancelable:!0,detail:{provide:i,text:t.text,key:t.key}});return this.expander.dispatchEvent(s)?(await Promise.all(n)).filter(c=>c.matched).map(c=>c.fragment)[0]:void 0}onMousedown(){this.interactingWithList=!0}onKeydown(t){t.key==="Escape"&&(this.match=null,this.deactivate()&&(this.lookBackIndex=this.input.selectionEnd||this.lookBackIndex,t.stopImmediatePropagation(),t.preventDefault()))}}class rt extends HTMLElement{get keys(){const t=this.getAttribute("keys"),n=t?t.split(" "):[],i=this.getAttribute("multiword"),s=i?i.split(" "):[],o=s.length===0&&this.hasAttribute("multiword");return n.map(r=>({key:r,multiWord:o||s.includes(r)}))}set keys(t){this.setAttribute("keys",t)}connectedCallback(){const t=this.querySelector('input[type="text"], textarea');if(!(t instanceof HTMLInputElement||t instanceof HTMLTextAreaElement))return;const n=new It(this,t);L.set(this,n)}disconnectedCallback(){const t=L.get(this);t&&(t.destroy(),L.delete(this))}dismiss(){const t=L.get(this);t&&t.dismissMenu()}}window.customElements.get("text-expander")||(window.TextExpanderElement=rt,window.customElements.define("text-expander",rt));
